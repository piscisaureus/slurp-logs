{"type":"message","nick":"CIA-155","message":"node: Ben Noordhuis v0.6 * ra64acd8 / test/simple/test-cluster-worker-death.js : test: cluster: add worker death event test - http://git.io/Q1CYgg","date":"2012-04-23T13:59:25.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: hey","date":"2012-04-23T14:25:11.000Z"}
{"type":"message","nick":"CIA-155","message":"node: Kyle Robinson Young master * r491c8d9 / doc/api/http.markdown :","date":"2012-04-23T14:31:04.000Z"}
{"type":"message","nick":"CIA-155","message":"node: doc: add deprecated function http.createClient()","date":"2012-04-23T14:31:04.000Z"}
{"type":"message","nick":"CIA-155","message":"node: Appears in a lot of old code and core tests. Documented to show it","date":"2012-04-23T14:31:05.000Z"}
{"type":"message","nick":"CIA-155","message":"node: is deprecated.","date":"2012-04-23T14:31:05.000Z"}
{"type":"message","nick":"CIA-155","message":"node: Closes #1613. - http://git.io/knSJAA","date":"2012-04-23T14:31:05.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: seems you've scared isaacs away","date":"2012-04-23T15:15:54.000Z"}
{"type":"message","nick":"piscisaureus_","message":"presumably","date":"2012-04-23T15:16:04.000Z"}
{"type":"message","nick":"isaacs","message":"piscisaureus_: hola","date":"2012-04-23T15:29:26.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: hey","date":"2012-04-23T15:29:34.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: you mentioned at some point that there were issues with http proxy when using 0.6 ?","date":"2012-04-23T15:29:56.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: did you ever figure that out?","date":"2012-04-23T15:30:32.000Z"}
{"type":"message","nick":"isaacs","message":"piscisaureus_: all the issues that i had with http-proxy were a result of write() sometimes happening when the socket had already closed, resulting in a throw","date":"2012-04-23T15:30:46.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: I thought there was some scalability problem?","date":"2012-04-23T15:31:03.000Z"}
{"type":"message","nick":"isaacs","message":"well, it only happens under load, if that's what you mean","date":"2012-04-23T15:31:16.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: yeah","date":"2012-04-23T15:31:21.000Z"}
{"type":"message","nick":"piscisaureus_","message":"so you never figured that out?","date":"2012-04-23T15:31:26.000Z"}
{"type":"message","nick":"isaacs","message":"no, i just wrapped the offenders in try/catch","date":"2012-04-23T15:31:34.000Z"}
{"type":"message","nick":"isaacs","message":"and if it threw, i killed the connection","date":"2012-04-23T15:31:43.000Z"}
{"type":"message","nick":"isaacs","message":"it's been working fine for a while now","date":"2012-04-23T15:31:53.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: alright","date":"2012-04-23T15:31:58.000Z"}
{"type":"message","nick":"isaacs","message":"it's kludgey and ugly, though","date":"2012-04-23T15:32:07.000Z"}
{"type":"message","nick":"isaacs","message":"i mean, that should be a 5 line program if we did it right","date":"2012-04-23T15:32:13.000Z"}
{"type":"message","nick":"isaacs","message":"except for the upgrade stuff, i guess, that gets a little more complicated","date":"2012-04-23T15:32:30.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: so what was that client_latency.js benchmark for?","date":"2012-04-23T15:32:38.000Z"}
{"type":"message","nick":"piscisaureus_","message":"isaacs: so we're mainly having problems that http proxy is too slow","date":"2012-04-23T15:33:00.000Z"}
{"type":"message","nick":"isaacs","message":"oh, that was just a problem with the http client, not with proxying","date":"2012-04-23T15:33:01.000Z"}
{"type":"message","nick":"piscisaureus_","message":"ah, right","date":"2012-04-23T15:33:05.000Z"}
{"type":"message","nick":"piscisaureus_","message":"good","date":"2012-04-23T15:33:08.000Z"}
{"type":"message","nick":"isaacs","message":"oh, ok, yeah, now i'm on the same page.","date":"2012-04-23T15:33:21.000Z"}
{"type":"message","nick":"isaacs","message":"the http client slows down dramatically if you make a bunch of requests that should all go in parallel","date":"2012-04-23T15:33:45.000Z"}
{"type":"message","nick":"piscisaureus_","message":"hmm","date":"2012-04-23T15:34:49.000Z"}
{"type":"message","nick":"piscisaureus_","message":"last weekend we had a serious issue with it","date":"2012-04-23T15:35:03.000Z"}
{"type":"message","nick":"piscisaureus_","message":"some requests would just hang in there for a couple of minutes (!)","date":"2012-04-23T15:35:15.000Z"}
{"type":"message","nick":"piscisaureus_","message":"while new requests would be serviced just fine","date":"2012-04-23T15:35:31.000Z"}
{"type":"message","nick":"piscisaureus_","message":"that was under significant load","date":"2012-04-23T15:35:50.000Z"}
{"type":"message","nick":"piscisaureus_","message":"but it seems that some serious starvation happens under load","date":"2012-04-23T15:36:52.000Z"}
{"type":"message","nick":"isaacs","message":"hm. that does match what we're seeing occasionally at joyent.","date":"2012-04-23T15:44:36.000Z"}
{"type":"message","nick":"isaacs","message":"i think we worked around it a different way","date":"2012-04-23T15:44:47.000Z"}
{"type":"message","nick":"isaacs","message":"i'm not sure.","date":"2012-04-23T15:44:47.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: btw, i updated that watcher pr","date":"2012-04-23T15:48:28.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: what doid you change?","date":"2012-04-23T15:51:01.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: i threw away the lseek commit","date":"2012-04-23T15:51:23.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"otherwise it's perfect as it is","date":"2012-04-23T15:51:33.000Z"}
{"type":"message","nick":"CIA-155","message":"libuv: Ben Noordhuis master * r1f001fe / src/unix/kqueue.c :","date":"2012-04-23T15:57:21.000Z"}
{"type":"message","nick":"CIA-155","message":"libuv: unix: remove kqueue cb == NULL check","date":"2012-04-23T15:57:21.000Z"}
{"type":"message","nick":"CIA-155","message":"libuv: The other implementations don't check for it and it's making the counters_init","date":"2012-04-23T15:57:22.000Z"}
{"type":"message","nick":"CIA-155","message":"libuv: test fail. - http://git.io/Ju8QCw","date":"2012-04-23T15:57:22.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] joyent/libuv#216 (master - 1f001fe : Ben Noordhuis): The build is still failing.","date":"2012-04-23T15:59:04.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/libuv/compare/1fa1c51...1f001fe","date":"2012-04-23T15:59:04.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/libuv/builds/1155493","date":"2012-04-23T15:59:04.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: ha!","date":"2012-04-23T16:46:11.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: is recv() not interruptible by a signal?","date":"2012-04-23T16:46:22.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: read the comments :)","date":"2012-04-23T16:46:32.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"in a nutshell, yes but not by SIGCHLD","date":"2012-04-23T16:46:43.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: the comments don't show up any more :-(","date":"2012-04-23T16:47:00.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: because you force pushed","date":"2012-04-23T16:47:04.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: that deletes all the comments","date":"2012-04-23T16:47:12.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: you get github notifications right?","date":"2012-04-23T16:47:19.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: yes, but so many :-/","date":"2012-04-23T16:48:18.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: okay, so recv() is interruptible but not by SIGCHLD at that point","date":"2012-04-23T16:48:55.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: is that also true for sunos?","date":"2012-04-23T16:49:08.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"yes","date":"2012-04-23T16:49:14.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"pselect() unblocks SIGCHLD while in the pselect() syscall","date":"2012-04-23T16:49:29.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"it's blocked again afterwards","date":"2012-04-23T16:49:35.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: ok, right","date":"2012-04-23T16:50:13.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: ah, so pselect was invented exactly for what we are doing","date":"2012-04-23T16:51:18.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: that is nice of those posix guys","date":"2012-04-23T16:51:24.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: the pull looks good to me","date":"2012-04-23T16:51:48.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: go ahead and merge it then :)","date":"2012-04-23T16:55:07.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: I am looking for the old commits","date":"2012-04-23T16:55:27.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"ben-doet-ook-een-duit-int-zakje <- haha","date":"2012-04-23T17:06:42.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: quid pro quo","date":"2012-04-23T17:07:12.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: question: do endgames run once and only once for a particular handle?","date":"2012-04-23T17:08:50.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"i want to add some code to uv_process_endgames","date":"2012-04-23T17:09:04.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: not on windows, no","date":"2012-04-23T17:09:05.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"damn","date":"2012-04-23T17:09:09.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: what is that?","date":"2012-04-23T17:09:18.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: i need a place to deref the handle when it's closed","date":"2012-04-23T17:09:35.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: ah","date":"2012-04-23T17:09:40.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: look for the place where the close callback is made :-)","date":"2012-04-23T17:09:48.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: ah I see","date":"2012-04-23T17:10:06.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: no, that won't really work","date":"2012-04-23T17:10:12.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"yes, close_cb... called in a lot of places","date":"2012-04-23T17:10:16.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: yeah","date":"2012-04-23T17:10:24.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"guess i'll add unref code to all handle endgame functions","date":"2012-04-23T17:10:25.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: yeah, it sucks I know","date":"2012-04-23T17:10:33.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: the engame stuff is a little messy","date":"2012-04-23T17:10:42.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"oh well","date":"2012-04-23T17:10:54.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: but it is also where I handle shutdown() and flushing and stuff.","date":"2012-04-23T17:10:56.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: because the queueing mechanism is not flexible enough to queue a req after all the writes finish","date":"2012-04-23T17:11:15.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"on a side note, i think there's a fair bit of code that we can eventually merge","date":"2012-04-23T17:12:34.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"the windows and unix approaches aren't that dissimilar","date":"2012-04-23T17:12:44.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"a double negative... quite similar is what i mean","date":"2012-04-23T17:13:11.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: btw, you should look at the mingw patches. they lgtm","date":"2012-04-23T17:15:56.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: also, one more question: what does the req that uv_fs_event_init_handle() creates do?","date":"2012-04-23T17:17:05.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"i noticed other init functions do something similar","date":"2012-04-23T17:17:33.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: yeah, a lot of handle types do that","date":"2012-04-23T17:24:40.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: basically they are a wrapper for the OVERLAPPED","date":"2012-04-23T17:24:50.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: because ReadDirectoryChangesW takes an overlapped which is inserted into the iocp when a changes happens","date":"2012-04-23T17:25:30.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: so when that comes out of the iocp we find back the req that contains the overlapped and we insert it in the request queue","date":"2012-04-23T17:26:05.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: that's also how the read_req works for streams","date":"2012-04-23T17:26:41.000Z"}
{"type":"message","nick":"piscisaureus_","message":"and the shutdown_req for pipes","date":"2012-04-23T17:26:45.000Z"}
{"type":"message","nick":"piscisaureus_","message":"etc","date":"2012-04-23T17:26:46.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: okay... so what i'm doing is ref'ing both the handle and the req","date":"2012-04-23T17:27:00.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"is that going to hurt?","date":"2012-04-23T17:27:03.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: well if we expose the refcount directly, yes","date":"2012-04-23T17:27:17.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"which we won't","date":"2012-04-23T17:27:26.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"so it doesn't matter otherwise?","date":"2012-04-23T17:27:41.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: well","date":"2012-04-23T17:27:46.000Z"}
{"type":"message","nick":"piscisaureus_","message":"I think it does","date":"2012-04-23T17:27:48.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: because the fs watcher *always* has a req pending","date":"2012-04-23T17:28:01.000Z"}
{"type":"message","nick":"piscisaureus_","message":"so you'd have to unref it twice","date":"2012-04-23T17:28:06.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"until you close it right?","date":"2012-04-23T17:28:12.000Z"}
{"type":"message","nick":"piscisaureus_","message":"yeah","date":"2012-04-23T17:28:16.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"right, that's taken care of","date":"2012-04-23T17:28:22.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: well if you uv_unref it then it won't work","date":"2012-04-23T17:28:30.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"well...","date":"2012-04-23T17:28:31.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"it's the handle that gets unref'd not, the req","date":"2012-04-23T17:28:44.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"grr","date":"2012-04-23T17:28:48.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: I think I would not ref reqs by default","date":"2012-04-23T17:28:52.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"embedded reqs you mean?","date":"2012-04-23T17:29:04.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: just the ones that should - write, connect etc","date":"2012-04-23T17:29:05.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"right","date":"2012-04-23T17:29:11.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: there's a lot of embedded reqs in there, I think more than explicit ones.","date":"2012-04-23T17:29:37.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: is it difficult to make your way through uv-win in general btw>","date":"2012-04-23T17:37:18.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: not really, it's just... different","date":"2012-04-23T17:39:41.000Z"}
{"type":"message","nick":"CIA-155","message":"libuv: Igor Zinkovsky v0.6 * re6d4bca / src/win/fs.c : remove left-over cast fixes #3160 - http://git.io/7DnvZw","date":"2012-04-23T17:53:42.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] joyent/libuv#217 (v0.6 - e6d4bca : Igor Zinkovsky): The build is still failing.","date":"2012-04-23T17:55:27.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/libuv/compare/21bee8c...e6d4bca","date":"2012-04-23T17:55:27.000Z"}
{"type":"message","nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/libuv/builds/1156355","date":"2012-04-23T17:55:27.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: there is something that concerns me a bit about this APC plan...","date":"2012-04-23T18:09:57.000Z"}
{"type":"message","nick":"piscisaureus_","message":"if the loop is very busy then GetQueuedCompletionStatusEx will always return immediately. I don't know if APCs have a chance to run when that happens.","date":"2012-04-23T18:09:57.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: that would mean that all shared sockets are always processed with the lowest possible priority... I'm not sure whether that is a good idea.","date":"2012-04-23T18:10:32.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: yeah, that's a valid concern","date":"2012-04-23T18:17:19.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: with a busy server, that'll mean that sends/recvs will always be processed before new connections are accepted","date":"2012-04-23T18:18:42.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: that would not be so bad... but if we do tcp connection sharing the situation may be reversed","date":"2012-04-23T18:19:40.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: maybe we can do a conditional WaitForMultipleObjectsEx call in between? (only if we're expecting APCs)","date":"2012-04-23T18:21:41.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: well... if doing that with timeout 0 would call the APCs then that would be great","date":"2012-04-23T18:22:31.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: oh hmm - I mean, we could also set an event and wait for that...","date":"2012-04-23T18:23:19.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: but I don't know if any APCs will be called when the awaited event is already set when WaitFor... is called.","date":"2012-04-23T18:23:57.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: meh.. looks like timeout=0 doesn't put it into wait state (which probably means it can't process APCs)","date":"2012-04-23T18:26:18.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: so if we do this","date":"2012-04-23T18:26:39.000Z"}
{"type":"message","nick":"piscisaureus_","message":"SetEvent(e)","date":"2012-04-23T18:26:39.000Z"}
{"type":"message","nick":"piscisaureus_","message":"WaitForSingleObjectEx(e, TRUE, INFINITE)","date":"2012-04-23T18:26:51.000Z"}
{"type":"message","nick":"piscisaureus_","message":"does that put it in the wait state?","date":"2012-04-23T18:27:02.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: i'd expect no.. but not sure","date":"2012-04-23T18:27:40.000Z"}
{"type":"message","nick":"piscisaureus_","message":"hmm","date":"2012-04-23T18:27:46.000Z"}
{"type":"message","nick":"piscisaureus_","message":":'-(","date":"2012-04-23T18:27:54.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: actually, it seems to work :_)","date":"2012-04-23T18:30:24.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: https://gist.github.com/2472912","date":"2012-04-23T18:31:43.000Z"}
{"type":"message","nick":"piscisaureus_","message":"meh","date":"2012-04-23T18:32:49.000Z"}
{"type":"message","nick":"piscisaureus_","message":"wrong args order","date":"2012-04-23T18:32:53.000Z"}
{"type":"message","nick":"piscisaureus_","message":"although that doesn't matter","date":"2012-04-23T18:33:16.000Z"}
{"type":"message","nick":"piscisaureus_","message":"so WaitForSingleObjectEx == +1","date":"2012-04-23T18:34:17.000Z"}
{"type":"message","nick":"piscisaureus_","message":"It will even process *all* the APCs before returning","date":"2012-04-23T18:34:56.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: nice!","date":"2012-04-23T18:35:54.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: hey","date":"2012-04-23T19:04:47.000Z"}
{"type":"message","nick":"piscisaureus_","message":"bnoordhuis_: you broke cloud9... can you talk to ruben on skype?","date":"2012-04-23T19:04:57.000Z"}
{"type":"message","nick":"mjr_","message":"So we rolled out the no idle GC notification patch to our entire operation over the weekend.","date":"2012-04-23T19:44:54.000Z"}
{"type":"message","nick":"isaacs","message":"mjr_: any effects visible yet?","date":"2012-04-23T19:51:23.000Z"}
{"type":"message","nick":"mjr_","message":"Not really. We have to restart our processes every day because of a memory leak and the TLS hang.","date":"2012-04-23T19:53:02.000Z"}
{"type":"message","nick":"piscisaureus_","message":"ghe","date":"2012-04-23T20:02:04.000Z"}
{"type":"message","nick":"piscisaureus_","message":"that sucks","date":"2012-04-23T20:02:07.000Z"}
{"type":"message","nick":"mjr_","message":"Yes it does. Any help would be appreciated.","date":"2012-04-23T20:05:37.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus_: it shoudl be fixed alreadt","date":"2012-04-23T20:08:33.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"also, both my girls are out with a fever so i don't have time to chat","date":"2012-04-23T20:08:53.000Z"}
{"type":"message","nick":"mraleph","message":"mjr_: which v8 version are you using?","date":"2012-04-23T20:10:33.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: when creating a context, most time is spent starting up and deserializing the snapshot, right?","date":"2012-04-23T20:13:09.000Z"}
{"type":"message","nick":"mraleph","message":"piscisaureus_: should be","date":"2012-04-23T20:13:33.000Z"}
{"type":"message","nick":"mraleph","message":"piscisaureus_: in preparation for deserializations there can be some gcs","date":"2012-04-23T20:13:58.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: so why don't you guys deserialize the snapshot into an immutable space and use that for all isolates/contexts?","date":"2012-04-23T20:14:21.000Z"}
{"type":"message","nick":"mraleph","message":"because it's not immutable :-)","date":"2012-04-23T20:14:56.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: so an object in that space would never refer to an object outside it","date":"2012-04-23T20:14:57.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: well... what is not immutable?","date":"2012-04-23T20:15:23.000Z"}
{"type":"message","nick":"mraleph","message":"e.g. ics in code objects","date":"2012-04-23T20:15:35.000Z"}
{"type":"message","nick":"mraleph","message":"prototypes of builtin objects","date":"2012-04-23T20:15:40.000Z"}
{"type":"message","nick":"mraleph","message":"there are some immutable objects there, sure… but I don't think it's an easy ride","date":"2012-04-23T20:16:09.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: right... so what if you just made a copy whenever you mutate it?","date":"2012-04-23T20:16:32.000Z"}
{"type":"message","nick":"mraleph","message":"yeah sure :-)","date":"2012-04-23T20:17:06.000Z"}
{"type":"message","nick":"mraleph","message":"but that requires plumbing","date":"2012-04-23T20:17:12.000Z"}
{"type":"message","nick":"mraleph","message":"COW arrays were not so easy to get.","date":"2012-04-23T20:17:24.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: so just fmi... what objects *do* get mutated?","date":"2012-04-23T20:17:49.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: I hear arrays, and I know that a string gets mutated when it is flattened","date":"2012-04-23T20:18:08.000Z"}
{"type":"message","nick":"mraleph","message":"piscisaureus_: code objects can be patched","date":"2012-04-23T20:18:42.000Z"}
{"type":"message","nick":"mraleph","message":"arrays can be mutated (and arrays can represent many different things, properties backing stores etc).","date":"2012-04-23T20:19:09.000Z"}
{"type":"message","nick":"piscisaureus_","message":"yeah, but the arrays in the snapshot are typically small","date":"2012-04-23T20:19:40.000Z"}
{"type":"message","nick":"piscisaureus_","message":"COW should not be so bad","date":"2012-04-23T20:19:46.000Z"}
{"type":"message","nick":"mraleph","message":"yeah it should not.","date":"2012-04-23T20:19:58.000Z"}
{"type":"message","nick":"piscisaureus_","message":"the biggest hurdle is probably checking whether something is in an immutable space and making a copy if","date":"2012-04-23T20:20:07.000Z"}
{"type":"message","nick":"mraleph","message":"as I say: it is possible, but requires plumbing.","date":"2012-04-23T20:20:09.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: yeah, ok","date":"2012-04-23T20:21:32.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: too bad :-)","date":"2012-04-23T20:21:36.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: I was thinking about how to do erlang in node","date":"2012-04-23T20:21:45.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: it would be nice to have lightweight contexts","date":"2012-04-23T20:21:56.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mraleph: but I won't bother you no more...","date":"2012-04-23T20:22:10.000Z"}
{"type":"message","nick":"mjr_","message":"mraleph: we are using 3.6.6.25 - https://gist.github.com/2473576","date":"2012-04-23T20:23:53.000Z"}
{"type":"message","nick":"mraleph","message":"mjr_: ok, I don't know about any GC related leaks in V8 of that version :-(","date":"2012-04-23T20:25:46.000Z"}
{"type":"message","nick":"mjr_","message":"mraleph: now that we are on SmartOS, I think we have the tools to better isolate this problem, it just takes more human time than we have.","date":"2012-04-23T20:31:02.000Z"}
{"type":"message","nick":"mjr_","message":"Sadly though, it seems like moving to SmartOS is partly what caused these problems.","date":"2012-04-23T20:31:43.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mjr_: rly? how?","date":"2012-04-23T20:32:12.000Z"}
{"type":"message","nick":"mjr_","message":"Well, who knows. That's just frustration talking.","date":"2012-04-23T20:32:25.000Z"}
{"type":"message","nick":"mjr_","message":"When we were on Linux, we did not have these memory growth problems, and we did not have to do rolling restarts of our entire operation every day.","date":"2012-04-23T20:32:42.000Z"}
{"type":"message","nick":"mjr_","message":"But when we moved to SmartOS, we also changed lots of other things like how many processes were on each machine, how many total machines, etc.","date":"2012-04-23T20:33:12.000Z"}
{"type":"message","nick":"Guest57630","message":"what version of nodejs were you on when you made that change?","date":"2012-04-23T20:33:13.000Z"}
{"type":"message","nick":"Guest57630","message":"ack","date":"2012-04-23T20:33:19.000Z"}
{"type":"message","nick":"mjr_","message":"I can't remember. It was about 2 months ago now.","date":"2012-04-23T20:33:45.000Z"}
{"type":"message","nick":"tjfontaine","message":"oh ok","date":"2012-04-23T20:33:51.000Z"}
{"type":"message","nick":"mjr_","message":"We generally track the v0.6 branch pretty closely.","date":"2012-04-23T20:33:56.000Z"}
{"type":"message","nick":"piscisaureus_","message":"why does fucking nano not work properly on these smartmachines","date":"2012-04-23T20:34:29.000Z"}
{"type":"message","nick":"mjr_","message":"My best theory is that the memory growth is some side effect of not handling back pressure properly.","date":"2012-04-23T20:34:51.000Z"}
{"type":"message","nick":"mjr_","message":"And because things run at different speeds in slightly different ways on Joyent, we ended up changing some variables in a giant and complicated feedback loop that makes things queue up in a place where they didn't queue up before.","date":"2012-04-23T20:35:47.000Z"}
{"type":"message","nick":"mjr_","message":"So it's not really fair to say that this is a SmartOS problem. It MIGHT be, but we just don't know.","date":"2012-04-23T20:36:15.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: hey","date":"2012-04-23T21:37:22.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: is the benchmark cluster available?","date":"2012-04-23T21:37:41.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: yt?","date":"2012-04-23T22:05:14.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: yep, it should be available.. let me check","date":"2012-04-23T22:07:27.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: i'll let you know","date":"2012-04-23T22:07:31.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: kewl","date":"2012-04-23T22:07:36.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: also, I lost the credentials... they are on my other computer","date":"2012-04-23T22:14:02.000Z"}
{"type":"message","nick":"piscisaureus_","message":"anyone here knows how to get useful output from the v8 tick profiler on solaris?","date":"2012-04-23T23:06:19.000Z"}
{"type":"message","nick":"piscisaureus_","message":"It shows 95% unknown :-/","date":"2012-04-23T23:06:29.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dap, isaacs, mjr_ ?","date":"2012-04-23T23:06:45.000Z"}
{"type":"message","nick":"piscisaureus_","message":"orlandovftw ?","date":"2012-04-23T23:06:54.000Z"}
{"type":"message","nick":"mjr_","message":"I do not.","date":"2012-04-23T23:07:02.000Z"}
{"type":"message","nick":"dap","message":"sorry, I've never used the V8 tick profiler. I always use jstack :)","date":"2012-04-23T23:07:10.000Z"}
{"type":"message","nick":"mjr_","message":"However, on SmartOS, you can use dap's winning jsstack","date":"2012-04-23T23:07:15.000Z"}
{"type":"message","nick":"piscisaureus_","message":"ah, right","date":"2012-04-23T23:07:21.000Z"}
{"type":"message","nick":"piscisaureus_","message":"how do I do that?","date":"2012-04-23T23:07:23.000Z"}
{"type":"message","nick":"isaacs","message":"yes, that's the way to go. tick ftl","date":"2012-04-23T23:07:23.000Z"}
{"type":"message","nick":"orlandovftw","message":"i did that a long time ago... but i dont remember offhand","date":"2012-04-23T23:07:30.000Z"}
{"type":"message","nick":"orlandovftw","message":"it wasn't super useful","date":"2012-04-23T23:07:39.000Z"}
{"type":"message","nick":"piscisaureus_","message":"is there a guide for jsstakc?","date":"2012-04-23T23:07:47.000Z"}
{"type":"message","nick":"mjr_","message":"I've actually never gotten useful information out of V8's profiler in node. It always sent me down the wrong path.","date":"2012-04-23T23:07:49.000Z"}
{"type":"message","nick":"dap","message":"# dtrace -n 'profile-97/pid == $target/{ @[jstack()] = count(); }' -p $yourpid","date":"2012-04-23T23:07:58.000Z"}
{"type":"message","nick":"dap","message":"when you CTRL-C it, you'll get the results.","date":"2012-04-23T23:08:09.000Z"}
{"type":"message","nick":"mjr_","message":"But jsstack + flame graph has been very enlightening.","date":"2012-04-23T23:08:13.000Z"}
{"type":"message","nick":"dap","message":"you'll probably want to check out http://dtrace.org/blogs/dap/2012/01/05/where-does-your-node-program-spend-its-time/, which has a little more detail and explains how to visualize it with a flame graph.","date":"2012-04-23T23:08:35.000Z"}
{"type":"message","nick":"mjr_","message":"The confusing thing is that V8's profiler SEEMS like it's telling you something useful, but in my experience it is now.","date":"2012-04-23T23:08:43.000Z"}
{"type":"message","nick":"mjr_","message":"not","date":"2012-04-23T23:08:44.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dap: do I need to compile with particular flags to make it show C functions?","date":"2012-04-23T23:09:03.000Z"}
{"type":"message","nick":"dap","message":"(you can skip steps (1) - (3) from that blog post, btw. I should probably update it to show that.)","date":"2012-04-23T23:09:06.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dap: 404","date":"2012-04-23T23:09:18.000Z"}
{"type":"message","nick":"dap","message":"piscisaureus_: no. it always shows both C and JavaScript functions, translating only where it makes sense.","date":"2012-04-23T23:09:20.000Z"}
{"type":"message","nick":"dap","message":"piscisaureus_: it works for me. did your client add the , ?","date":"2012-04-23T23:09:35.000Z"}
{"type":"message","nick":"mjr_","message":"dap: have you demangled the C++ symbols successfully?","date":"2012-04-23T23:09:42.000Z"}
{"type":"message","nick":"piscisaureus_","message":"yep","date":"2012-04-23T23:09:43.000Z"}
{"type":"message","nick":"piscisaureus_","message":":-)","date":"2012-04-23T23:09:46.000Z"}
{"type":"message","nick":"piscisaureus_","message":"sorry, idiot alarm","date":"2012-04-23T23:09:49.000Z"}
{"type":"message","nick":"dap","message":"mjr_: yeah, I pipe the output through c++filt to do that.","date":"2012-04-23T23:09:51.000Z"}
{"type":"message","nick":"mjr_","message":"c++filt never does anything for me.","date":"2012-04-23T23:09:59.000Z"}
{"type":"message","nick":"dap","message":"…I should update that example too :)","date":"2012-04-23T23:09:59.000Z"}
{"type":"message","nick":"kohai","message":"c has 9 beers","date":"2012-04-23T23:10:00.000Z"}
{"type":"message","nick":"dap","message":"mjr_: are you running it on the smartos system?","date":"2012-04-23T23:10:11.000Z"}
{"type":"message","nick":"mjr_","message":"It ends up with identical output as input.","date":"2012-04-23T23:10:11.000Z"}
{"type":"message","nick":"mjr_","message":"Oh, no. I was doing post-processing on my mac.","date":"2012-04-23T23:10:28.000Z"}
{"type":"message","nick":"dap","message":"I found that using MacOS's c++filt with SmartOS's output or vice versa doesn't work.","date":"2012-04-23T23:10:32.000Z"}
{"type":"message","nick":"dap","message":"in exactly that way.","date":"2012-04-23T23:10:35.000Z"}
{"type":"message","nick":"mjr_","message":"Ahhh","date":"2012-04-23T23:10:38.000Z"}
{"type":"message","nick":"mjr_","message":"i will try that, thanks.","date":"2012-04-23T23:10:41.000Z"}
{"type":"message","nick":"dap","message":"I assume it's because demangling is compiler-specific, though I've been told it's been standardized.","date":"2012-04-23T23:10:49.000Z"}
{"type":"message","nick":"mjr_","message":"Different compiler versions for sure.","date":"2012-04-23T23:10:59.000Z"}
{"type":"message","nick":"mjr_","message":"clang vs. gcc, etc.","date":"2012-04-23T23:11:06.000Z"}
{"type":"message","nick":"dap","message":"teag","date":"2012-04-23T23:11:09.000Z"}
{"type":"message","nick":"dap","message":"yeah*","date":"2012-04-23T23:11:10.000Z"}
{"type":"message","nick":"mjr_","message":"I would like to give C more beers, but C++ keeps getting them.","date":"2012-04-23T23:11:49.000Z"}
{"type":"message","nick":"piscisaureus_","message":"eh, in reverse you mean?","date":"2012-04-23T23:12:03.000Z"}
{"type":"message","nick":"piscisaureus_","message":"c++++","date":"2012-04-23T23:12:05.000Z"}
{"type":"message","nick":"kohai","message":"c has 10 beers","date":"2012-04-23T23:12:07.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dtrace: 55 jstack()/ustack() string table overflows","date":"2012-04-23T23:13:39.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dap: ^-- those errors are normal?","date":"2012-04-23T23:13:48.000Z"}
{"type":"message","nick":"mjr_","message":"piscisaureus_: @[jstack(100, 8000)] = count();","date":"2012-04-23T23:14:17.000Z"}
{"type":"message","nick":"dap","message":"piscisaureus_: they're harmless, but means you'll be missing some translations. What mjr_ said will fix it.","date":"2012-04-23T23:14:26.000Z"}
{"type":"message","nick":"dap","message":"100 = 100 stack frames, and 8000 is a buffer size.","date":"2012-04-23T23:14:35.000Z"}
{"type":"message","nick":"piscisaureus_","message":"aha","date":"2012-04-23T23:14:39.000Z"}
{"type":"message","nick":"piscisaureus_","message":"thanks","date":"2012-04-23T23:14:40.000Z"}
{"type":"message","nick":"mjr_","message":"Look at me, I'm answering questions about dtrace.","date":"2012-04-23T23:14:56.000Z"}
{"type":"message","nick":"dap","message":":)","date":"2012-04-23T23:15:02.000Z"}
{"type":"message","nick":"piscisaureus_","message":"mjr_: yeah, thanks a lot ;_)","date":"2012-04-23T23:15:04.000Z"}
{"type":"message","nick":"mjr_","message":"Seriously though, this jsstack thing is a game changer for node.","date":"2012-04-23T23:15:22.000Z"}
{"type":"message","nick":"piscisaureus_","message":"now unfortunately it blasts stack frames through my console","date":"2012-04-23T23:15:25.000Z"}
{"type":"message","nick":"mjr_","message":"piscisaureus_: dtrace -n 'profile-97 /pid == 1234/ { @[jstack(100, 8000)] = count(); } tick-30s { exit(0); }' -o out.stacks","date":"2012-04-23T23:15:59.000Z"}
{"type":"message","nick":"mjr_","message":"That'll sample for 30 seconds, count the stacks, then write to out.stacks on exit.","date":"2012-04-23T23:16:36.000Z"}
{"type":"message","nick":"piscisaureus_","message":"wow","date":"2012-04-23T23:17:08.000Z"}
{"type":"message","nick":"mjr_","message":"Or use -p, etc.","date":"2012-04-23T23:17:10.000Z"}
{"type":"message","nick":"piscisaureus_","message":"so how do I generate the flame graph? There's another option for that?","date":"2012-04-23T23:17:29.000Z"}
{"type":"message","nick":"piscisaureus_","message":"seems kind of unexpected to have that in dtrace","date":"2012-04-23T23:17:50.000Z"}
{"type":"message","nick":"piscisaureus_","message":"so what do I get for that?","date":"2012-04-23T23:17:56.000Z"}
{"type":"message","nick":"mjr_","message":"The world must learn about this jsstack + flame graph technology.","date":"2012-04-23T23:17:59.000Z"}
{"type":"message","nick":"piscisaureus_","message":"yes","date":"2012-04-23T23:18:05.000Z"}
{"type":"message","nick":"piscisaureus_","message":"ah let's just read dap's blog :-)","date":"2012-04-23T23:18:23.000Z"}
{"type":"message","nick":"igorzi","message":"piscisaureus_: i'll send you an email with the credential as soon as i verify that the test cluster is up","date":"2012-04-23T23:19:11.000Z"}
{"type":"message","nick":"piscisaureus_","message":"igorzi: cool","date":"2012-04-23T23:19:17.000Z"}
{"type":"message","nick":"piscisaureus_","message":"ah, got my first flame graph","date":"2012-04-23T23:30:10.000Z"}
{"type":"message","nick":"piscisaureus_","message":"nice","date":"2012-04-23T23:30:11.000Z"}
{"type":"message","nick":"piscisaureus_","message":"dap++","date":"2012-04-23T23:30:14.000Z"}
{"type":"message","nick":"kohai","message":"dap has 2 beers","date":"2012-04-23T23:30:15.000Z"}
{"type":"message","nick":"piscisaureus_","message":"and mjr_ thanks!","date":"2012-04-23T23:30:19.000Z"}
{"type":"message","nick":"dap","message":"great!","date":"2012-04-23T23:30:25.000Z"}
{"type":"message","nick":"piscisaureus_","message":"that wasn't so hard","date":"2012-04-23T23:30:36.000Z"}
{"type":"message","nick":"piscisaureus_","message":"but the manual needs a tl;dr version","date":"2012-04-23T23:30:47.000Z"}
{"type":"message","nick":"piscisaureus_","message":"aka hello world","date":"2012-04-23T23:30:51.000Z"}
{"type":"message","nick":"dap","message":"yeah, agreed.","date":"2012-04-23T23:30:54.000Z"}
{"type":"message","nick":"piscisaureus_","message":"after they first succeed people get interested","date":"2012-04-23T23:31:09.000Z"}
{"type":"message","nick":"isaacs","message":"making actual websites in node is way way too hard.","date":"2012-04-23T23:40:57.000Z"}
{"type":"message","nick":"isaacs","message":"not even because of the callbackitis or whatever.","date":"2012-04-23T23:41:23.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"piscisaureus__: okay, back. you were saying?","date":"2012-04-23T23:52:18.000Z"}
{"type":"message","nick":"bnoordhuis_","message":"also, your log bot is broken","date":"2012-04-23T23:52:28.000Z"}
{"type":"message","nick":"piscisaureus__","message":"bnoordhuis_: never mind. Talk to Jos on skype","date":"2012-04-23T23:57:59.000Z"}
{"type":"message","nick":"piscisaureus__","message":"bnoordhuis_: also, why did you break my bot?","date":"2012-04-23T23:58:09.000Z"}
{"type":"message","nick":"bnoordhuis","message":"piscisaureus__: jos or ruben?","date":"2012-04-23T23:59:32.000Z"}
{"type":"message","nick":"piscisaureus__","message":"bnoordhuis: jos","date":"2012-04-23T23:59:39.000Z"}
{"type":"message","nick":"bnoordhuis","message":"okay, i'll ping him tomorrow. what's it about?","date":"2012-04-23T23:59:57.000Z"}
